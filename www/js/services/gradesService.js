/*jshint bitwise: false*/

"use strict";

angular.module("wuw.services")

.factory("Grades", function($http, $q, Settings) {
    var dishes = JSON.parse(Settings.getSetting('dishesCache') || '[]');
    var numberOfDishes = 18;

    var parseXML = function(xml) {
        var dom = null;
        if (window.DOMParser) {
            try { dom = (new DOMParser()).parseFromString(xml, "text/xml"); }
            catch (e) { dom = null; }
        }
        return dom;
    };

    var getGrades = function() {
        var deferred = $q.defer();

        var xml = "<?xml version='1.0' standalone='yes'?><ex>    <es>        <e>            <nummer>1020</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Diskrete Mathematik</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>28.01.2014</datum>        </e>        <e>            <nummer>1025</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>PVL Diskrete Mathematik</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>1040</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Programmieren 1</text>            <versuch>1</versuch>            <bonus>8.0</bonus>            <datum />        </e>        <e>            <nummer>1050</nummer>            <note>230</note>            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Betriebswirtschaftslehre</text>            <versuch>1</versuch>            <bonus>4.0</bonus>            <datum>03.02.2014</datum>        </e>        <e>            <nummer>1060</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Arbeitstechnik im Studium</text>            <versuch>1</versuch>            <bonus>2.0</bonus>            <datum />        </e>        <e>            <nummer>1070</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Fremdsprachen</text>            <versuch>1</versuch>            <bonus>2.0</bonus>            <datum />        </e>        <e>            <nummer>1030</nummer>            <note>130</note>            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Einführ. i.d. Informatik</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>30.01.2014</datum>        </e>        <e>            <nummer>1010</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>Mathematik 1</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>1035</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20132</semester>            <text>PVL Einf. i.d. Informatik</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>2010</nummer>            <note>370</note>            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>Mathematik 2</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>07.07.2014</datum>        </e>        <e>            <nummer>2020</nummer>            <note>470</note>            <bestanden>NB</bestanden>            <semester>20141</semester>            <text>Lineare Algebra</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum>14.07.2014</datum>        </e>        <e>            <nummer>2015</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>PVL Mathematik 2</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>2030</nummer>            <note>230</note>            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>Programmieren 2</text>            <versuch>1</versuch>            <bonus>7.0</bonus>            <datum>16.07.2014</datum>        </e>        <e>            <nummer>2050</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>Internet-Programmierung</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>2035</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>PVL Programmieren 2</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>2045</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>PVL Informatik-Projekt 1</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>2040</nummer>            <note>130</note>            <bestanden>BE</bestanden>            <semester>20141</semester>            <text>Informatik-Projekt 1</text>            <versuch>1</versuch>            <bonus>9.0</bonus>            <datum />        </e>        <e>            <nummer>2020</nummer>            <note>270</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Lineare Algebra</text>            <versuch>2</versuch>            <bonus>3.0</bonus>            <datum>12.02.2015</datum>        </e>        <e>            <nummer>3012</nummer>            <note>370</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Statistik</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>06.02.2015</datum>        </e>        <e>            <nummer>3020</nummer>            <note>200</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Datenstrukt.u.Algorithmen</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>03.02.2015</datum>        </e>        <e>            <nummer>3025</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>PVL Datenstruk. u Algo.</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum>02.02.2015</datum>        </e>        <e>            <nummer>2998</nummer>            <note>000</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Erzielte CP GS</text>            <versuch>1</versuch>            <bonus>60.0</bonus>            <datum>12.02.2015</datum>        </e>        <e>            <nummer>3030</nummer>            <note>100</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Software- Technik</text>            <versuch>1</versuch>            <bonus>8.0</bonus>            <datum>11.02.2015</datum>        </e>        <e>            <nummer>2999</nummer>            <note>220</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Bachelor-Vorprüfung</text>            <versuch>1</versuch>            <bonus>60.0</bonus>            <datum>12.02.2015</datum>        </e>        <e>            <nummer>3035</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>PVL Software- Technik</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum>02.02.2015</datum>        </e>        <e>            <nummer>3040</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Betriebssysteme</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>3050</nummer>            <note>200</note>            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>Theoretische Informatik</text>            <versuch>1</versuch>            <bonus>4.0</bonus>            <datum>05.02.2015</datum>        </e>        <e>            <nummer>3055</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20142</semester>            <text>PVL Theor.Informatik</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum>02.02.2015</datum>        </e>        <e>            <nummer>4010</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Datenbanksysteme</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>16.07.2015</datum>        </e>        <e>            <nummer>4015</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>PVL Datenbanksysteme</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum>06.07.2015</datum>        </e>        <e>            <nummer>4020</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Programmieren 3</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>4030</nummer>            <note>100</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Technische Informatik</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>4040</nummer>            <note>130</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>IT-Sicherheit</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>4050</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Kommunikationssysteme</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>07.07.2015</datum>        </e>        <e>            <nummer>4055</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>PVL Kommunikationssysteme</text>            <versuch>1</versuch>            <bonus>0.0</bonus>            <datum />        </e>        <e>            <nummer>3013</nummer>            <note>100</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Operations Research</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>13.07.2015</datum>        </e>        <e>            <nummer>5030</nummer>            <note>130</note>            <bestanden>BE</bestanden>            <semester>20151</semester>            <text>Mensch-Maschine-Komm</text>            <versuch>1</versuch>            <bonus>2.0</bonus>            <datum />        </e>        <e>            <nummer>18070</nummer>            <note>100</note>            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>High Performance Computin</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum>05.02.2016</datum>        </e>        <e>            <nummer>18080</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>Geo Visualisierung</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>17020</nummer>            <note>170</note>            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>Autom. Sprachverarbeitung</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>18060</nummer>            <note>130</note>            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>IT-Sicherheit</text>            <versuch>1</versuch>            <bonus>5.0</bonus>            <datum />        </e>        <e>            <nummer>5020</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>Präsentationstechnik</text>            <versuch>1</versuch>            <bonus>2.0</bonus>            <datum />        </e>        <e>            <nummer>6050</nummer>            <note>100</note>            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>Informatik-Projekt 2</text>            <versuch>1</versuch>            <bonus>7.0</bonus>            <datum />        </e>        <e>            <nummer>6060</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20152</semester>            <text>Seminar</text>            <versuch>1</versuch>            <bonus>3.0</bonus>            <datum>01.02.2016</datum>        </e>        <e>            <nummer>5010</nummer>            <note />            <bestanden>BE</bestanden>            <semester>20161</semester>            <text>Betr Prak. Studienprojekt</text>            <versuch>1</versuch>            <bonus>26.0</bonus>            <datum />        </e>    </es></ex>";
        var dom = parseXML(xml), json = xml2json(dom);

         deferred.resolve(json);

        // $http({
        //     url: 'https://php.rz.hft-stuttgart.de/hftapp/notenhftapp.php',
        //     method: "POST",
        //     headers: {'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8'},
        //     data: "username=username&password=PW"
        // })
        // .then(function(response) {
        //     deferred.resolve(response);
        //     //console.log(response);
        //     var parser = new DOMParser();
        //     var xmlDoc = parser.parseFromString(response, "text/xml");
        //     // newDeadline._id = response.data.id;
        //     // deadlines.push(newDeadline);
        //     // Settings.setSetting('localDeadlines', JSON.stringify(deadlines));
        // },
        // function(response) {
        //     deferred.reject(response);
        // });
        return deferred.promise;
    };

    return {
        getGrades: getGrades
    };
});
